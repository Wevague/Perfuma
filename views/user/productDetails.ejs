

<%- include("../partials/user/header") %>

<style>
    
    :root {
        --primary-color: #3a86ff;
        --secondary-color: #8338ec;
        --accent-color: #ff006e;
        --background-color: #f8f9fa;
        --text-color: #333;
        --light-gray: #e9ecef;
    }
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: var(--text-color);
        background-color: var(--background-color);
        margin: 0;
        padding: 0;
    }
    /* .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    } */
    .product-container {
        display: flex;
        flex-wrap: wrap;
        gap: 40px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 30px;
        margin-bottom: 40px;
    }
    .product-image-container {
        flex: 1;
        min-width: 300px;
    }
    .product-image img {
        width: 100%;
        height: auto;
        border-radius: 10px;
        transition: transform 0.3s ease;
    }
    .product-image img:hover {
        transform: scale(1.05);
    }
    .product-previews {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        margin-top: 20px;
    }
    .product-preview {
        width: calc(25% - 7.5px);
        cursor: pointer;
    }
    .product-preview img {
        width: 100%;
        height: auto;
        border-radius: 5px;
        transition: transform 0.3s ease;
    }
    .product-preview img:hover {
        transform: scale(1.1);
    }
    .product-info {
        flex: 2;
        min-width: 300px;
    }
    .product-title {
        font-size: 32px;
        margin-bottom: 15px;
        color: var(--primary-color);
    }
    .ratings {
        color: #ffc107;
        font-size: 18px;
        margin-bottom: 15px;
    }
    .price {
        font-size: 28px;
        font-weight: bold;
        margin-bottom: 15px;
        color: var(--accent-color);
    }
    .discount {
        background-color: var(--secondary-color);
        color: white;
        padding: 8px 15px;
        border-radius: 25px;
        font-size: 14px;
        margin-bottom: 15px;
        display: inline-block;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .stock {
        font-weight: bold;
        margin-bottom: 15px;
        padding: 8px 15px;
        border-radius: 25px;
        display: inline-block;
    }
    .in-stock {
        background-color: #28a745;
        color: white;
    }
    .out-of-stock {
        background-color: #dc3545;
        color: white;
    }
    .ml-selection {
        margin-bottom: 20px;
    }
    .ml-options {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
    }
    .ml-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: calc(33.33% - 10px);
    }
    .ml-box {
        width: 100%;
        padding: 10px;
        border: 2px solid var(--primary-color);
        border-radius: 8px;
        cursor: pointer;
        background-color: white;
        color: var(--primary-color);
        font-size: 16px;
        font-weight: bold;
        transition: all 0.3s ease;
        text-align: center;
    }
    .ml-box.active {
        background-color: var(--primary-color);
        color: white;
    }
    .ml-box.disabled {
        background-color: #e0e0e0;
        color: #a0a0a0;
        pointer-events: none;
    }
    .qty-box {
        width: 100%;
        background-color: #fff;
        border: 2px solid #ddd;
        border-radius: 8px;
        padding: 5px;
        text-align: center;
        font-size: 14px;
        color: #555;
        margin-top: 5px;
    }
    .qty-box.low-stock {
        color: #e74c3c;
        font-weight: bold;
    }
    .quantity-selection {
        margin-top: 20px;
        margin-bottom: 20px;
    }
    .quantity-controls {
        display: flex;
        align-items: center;
        width: fit-content;
    }
    .quantity-btn {
        width: 30px;
        height: 30px;
        background-color: var(--light-gray);
        border: none;
        border-radius: 50%;
        font-size: 18px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    .quantity-btn:hover {
        background-color: var(--primary-color);
        color: white;
    }
    .quantity-input {
        width: 50px;
        height: 30px;
        text-align: center;
        border: 1px solid var(--light-gray);
        border-radius: 4px;
        margin: 0 10px;
        font-size: 16px;
    }
    .button-group {
        margin-top: 30px;
    }
    .btn {
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        margin-right: 10px;
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .btn-primary {
        background-color: var(--primary-color);
        color: white;
        border: none;
        box-shadow: 0 4px 6px rgba(58, 134, 255, 0.4);
    }
    .btn-primary:hover {
        background-color: #2a6fdb;
        box-shadow: 0 6px 10px rgba(58, 134, 255, 0.6);
    }
    .btn-accent {
        background-color: var(--accent-color);
        color: white;
        border: none;
        box-shadow: 0 4px 6px rgba(255, 0, 110, 0.4);
    }
    .btn-accent:hover {
        background-color: #e60062;
        box-shadow: 0 6px 10px rgba(255, 0, 110, 0.6);
    }
    .highlights {
        margin-top: 30px;
        background-color: var(--light-gray);
        padding: 20px;
        border-radius: 10px;
    }
    .highlights h3 {
        margin-bottom: 15px;
        color: var(--primary-color);
    }
    .highlights ul {
        padding-left: 20px;
        list-style-type: none;
    }
    .highlights li {
        margin-bottom: 10px;
        position: relative;
        padding-left: 25px;
    }
    .highlights li::before {
        content: '✓';
        position: absolute;
        left: 0;
        color: var(--secondary-color);
        font-weight: bold;
    }
    .reviews {
        margin-top: 40px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 30px;
    }
    .reviews h2 {
        margin-bottom: 20px;
        color: var(--primary-color);
    }
    .review {
        background-color: var(--light-gray);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
    }
    .review h4 {
        margin-top: 10px;
        margin-bottom: 5px;
        color: var(--secondary-color);
    }
    .related-products {
        margin-top: 40px;
    }
    .related-products h3 {
        margin-bottom: 20px;
        color: var(--primary-color);
    }
    .related-product-list {
        display: flex;
        gap: 20px;
        overflow-x: auto;
        padding-bottom: 20px;
    }
    .related-product-item {
        min-width: 200px;
        text-align: center;
        background-color: #fff;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
    }
    .related-product-item:hover {
        transform: translateY(-5px);
    }
    .related-product-item img {
        max-width: 100%;
        height: auto;
        border-radius: 10px;
        margin-bottom: 10px;
    }
    .related-product-item p:first-of-type {
        font-weight: bold;
        color: var(--secondary-color);
    }
    .related-product-item p:last-of-type {
        color: var(--accent-color);
        font-weight: bold;
    }
    @media (max-width: 768px) {
        .product-container {
            flex-direction: column;
        }
        .ml-option {
            width: calc(50% - 7.5px);
        }
        .related-product-list {
            flex-wrap: wrap;
            justify-content: center;
        }
        .related-product-item {
            width: calc(50% - 10px);
        }
    }   

    #imageZoom {
    width: 100%;
    height: 50%;
    object-fit: cover;
    object-position: 0 0;
    position: relative;
    overflow: hidden; 
}

#imageZoom::after {
    display: none; 
    content: '';
    width: 100%;
    height: 100%;
    background-color: white;
    background-image: var(--url);
    background-size: 200%;
    background-position: var(--zoom-x) var(--zoom-y);
    position: absolute;
    top: 0;
    left: 0;
}

#imageZoom:hover::after {
    display: block; 
}
.original-price {
    color: #888;
    text-decoration: line-through;
    margin-right: 10px;
    font-size: 22px;
}

</style>

<form id="productForm" action="/cart" method="POST">
    <input type="hidden" id="productId" value="<%= productData._id %>">
    <div class="container">
        <div class="breadcrumbs">
            <a href="#">Home</a> &gt; <a href="#">Fragrances</a> &gt; Premium Perfume
        </div>

        <div class="product-container">
            <div class="product-image-container">
                <div class="product-image" id="imageZoom" style="
    --url:url('/uploads/re-image/<%= productData.productImage[0] %>'); 
    --zoom-x: 0%; 
    --zoom-y: 0%;
">
    <img src="/uploads/re-image/<%= productData.productImage[0] %>" alt="Premium Perfume">
</div>

                <div class="product-previews">
                    <% for(let i=0; i<productData.productImage.length; i++) { %>
                    <div class="product-preview" onclick="changeMainImage('<%= productData.productImage[i] %>')">
                        <img src="/uploads/re-image/<%= productData.productImage[i] %>" alt="Perfume Preview <%= i+1 %>">
                    </div>
                    <% } %>
                </div>
            </div>
            <div class="product-info">
                <h1 class="product-title"><%= productData.productName %></h1>
                <div class="ratings">★★★★☆ (4.5/5)</div>
                <div class="price" id="orginal">

                    <!-- <span id="priceDisplay">$<%= productData.stock.price %></span> -->
                </div>
                
                <div class="price">
                    
                    <span id="priceDisplay">$<%= productData.regularPrice %></span>
                    
                </div>

               
                <div class="description"><%= productData.description %></div>   
                <br>
                <div class="color"><%= productData.color %></div>
                <% if (couponCode) { %>
                <div class="discount">
                    <% if (couponCode) { %>
                         OFF - Use code: <%= couponCode %>
                    <% } else { %>
                        No coupon available for you at the moment.
                    <% } %>
                </div>
                <% } %>
                
                <% if (totalQty === 0) { %>
                    <div class="stock out-of-stock">Out of Stock</div>
                <% } else { %>
                    <div class="stock in-stock">In Stock</div>
                <% } %>
              
                <div class="ml-selection">
                    <!-- <h3>Select Size:</h3> -->
                    <div class="ml-options">
                        <% stockData.forEach(item => { %>
                            <div class="ml-option">
                                <div class="ml-box <%= item.quantity === 0 ? 'disabled' : '' %>" data-value="<%= item.volume %>" data-price="<%= item.finalDiscountedPrice %>">
                                    <%= item.volume %>ML
                                </div>
                                <div class="qty-box <%= item.quantity < 5 ? 'low-stock' : '' %>">
                                    Qty <%= item.quantity %>
                                </div>
                                <% if (item.productDiscountedPrice<item.originalPrice ) { %>
                                    <span id="orginal" class="original-price"> $<%= item.originalPrice.toFixed(2) %></span>
                                <% } %>
                               
                                   
                                 
                            </div>
                        <% }); %>
                    </div>
                </div>
                

                <div class="quantity-selection">
                 
               <br>
               <% if (inWishlist) { %>
                <div>
                    <button type="button" class="btn btn-accent" id="add-to-wishlist" disabled>Added to Wishlist</button>
                </div>
            <% } else { %>  
                <div>
                    <button type="button" class="btn btn-accent" id="add-to-wishlist" data-product-id="<%= productData._id %>">Add to Wishlist</button>
                </div>
            <% } %>
            
                </div>

                <% if (totalQty !== 0) { %>
                    <div class="button-group">
                        <button type="button" class="btn btn-primary" onclick="addToCart('<%= productData._id %>', parseInt(document.querySelector('.quantity-input').value))">Add to Cart</button>
                     <!-- <a href="/checkout">   <button type="button" id="buyNow" class="btn btn-accent">Buy Now</button></a> -->
                    </div>
                <% } %>

                <div class="highlights">
                    <h3>Highlights</h3>
                    <ul>
                        <li>Long-lasting fragrance with up to 24-hour wear</li>
                        <li>Rich and complex scent profile</li>
                        <li>Made with high-quality, sustainably sourced ingredients</li>
                        <li>Elegant and luxurious packaging</li>
                        <li>Suitable for both day and evening wear</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="reviews">
            <h2>Customer Reviews</h2>
            <div class="review">
                <div class="ratings">★★★★★</div>
                <h4>Exquisite fragrance!</h4>
                <p>This perfume has an amazing scent that lasts all day. I've received numerous compliments since I started wearing it.</p>
            </div>
            <div class="review">
                <div class="ratings">★★★★☆</div>
                <h4>Great scent, but pricey</h4>
                <p>The fragrance is wonderful and long-lasting. However, it's a bit on the expensive side. Still, the quality is undeniable.</p>
            </div>
        </div>

        <div class="related-products">
            <h3>Related Products</h3>
            <div  class="related-product-list">
                <% relatedProducts.forEach(product => { %>
                
                <div class="related-product-item">
                    <a class="product-item" href="/productDetails?id=<%= product._id %>">
                    <img src="/uploads/re-image/<%= product.productImage[0] %>" alt="<%= product.productName %>">
                    <p><%= product.productName %></p>
                    <!-- <p>$<%= product.regularPrice %></p> -->
                </a>
                </div>
                <% }) %>
            </div>
        </div>
    </div>
</form>

<script>




document.addEventListener('DOMContentLoaded', function() {
    const addToWishlistButtons = document.querySelectorAll('#add-to-wishlist');

    addToWishlistButtons.forEach(button => {
        button.addEventListener('click', async function() {
            const productId = this.getAttribute('data-product-id');
            
            try {
                const response = await fetch('/wishlist', {
                    method: 'POST', 
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ productId: productId }), 
                });

                if (!response.ok) {
                    throw new Error('Failed to add to wishlist');
                }

               
                this.textContent = 'Added to Wishlist';
                this.disabled = true; 
                console.log('Product added to wishlist');
            } catch (error) {
                console.error('Error adding product to wishlist:', error);
            }
        });
    });
});



function changeMainImage(imageSrc) {
        const mainImage = document.querySelector('#imageZoom img');
        mainImage.src = '/uploads/re-image/' + imageSrc;

        const imageZoom = document.getElementById('imageZoom');
        imageZoom.style.setProperty('--url', 'url("/uploads/re-image/' + imageSrc + '")');
    }




let imageZoom = document.getElementById('imageZoom');

imageZoom.addEventListener('mousemove', (event) => {
    imageZoom.style.setProperty('--display', 'block');
    
    
    let pointer = {
        x: (event.offsetX * 100) / imageZoom.offsetWidth,  
        y: (event.offsetY * 100) / imageZoom.offsetHeight 
    };

    
    imageZoom.style.setProperty('--zoom-x', `${pointer.x}%`);
    imageZoom.style.setProperty('--zoom-y', `${pointer.y}%`);
});

imageZoom.addEventListener('mouseout', () => {
   
    imageZoom.style.setProperty('--display', 'none');
});

document.addEventListener('DOMContentLoaded', function() {
    const mlBoxes = document.querySelectorAll('.ml-box');
    const priceDisplay = document.getElementById('priceDisplay');  
    const originalPriceElements = document.querySelectorAll('.original'); 
    let selectedPrice = null;
    let selectedVolume = null;

    let smallestPrice = Infinity;
    let smallestVolume = null;

    mlBoxes.forEach(box => {
        const boxPrice = parseFloat(box.dataset.price);
        if (boxPrice < smallestPrice) {
            smallestPrice = boxPrice;
            smallestVolume = box.dataset.value;
        }
    });

    if (smallestPrice !== Infinity) {
        priceDisplay.textContent = `$${smallestPrice.toFixed(2)}`;
        selectedPrice = smallestPrice;
        selectedVolume = smallestVolume;
        mlBoxes.forEach(box => {
            if (box.dataset.value === smallestVolume) {
                box.classList.add('active');
            }
        });
    }

    mlBoxes.forEach(box => {
        box.addEventListener('click', () => {
            mlBoxes.forEach(b => b.classList.remove('active'));
            box.classList.add('active');

            selectedVolume = box.dataset.value;
            selectedPrice = parseFloat(box.dataset.price);

            if (selectedPrice) {
                priceDisplay.textContent = `$${selectedPrice.toFixed(2)}`;
            }
            originalPriceElements.forEach(el => el.style.display = 'none');

            const selectedOriginalPrice = box.closest('.ml-option').querySelector('.original');
            if (selectedOriginalPrice) {
                selectedOriginalPrice.style.display = 'inline-block'; // Show the original price
            }
        });
    });

    const addToCartButton = document.querySelector('.btn-primary');
    addToCartButton.addEventListener('click', function() {
        if (!selectedVolume) {
            alert("Please select a volume.");
            return;
        }

        const productId = document.getElementById("productId").value;
        const quantity = 1; // Fixed quantity of 1

        fetch('/cart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                productId: productId,
                quantity: quantity,
                selectedVolume: selectedVolume,
                price: selectedPrice
            })  
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                Swal.fire({
                    icon: 'success',
                    title: 'Item added to cart!',
                    text: 'The item has been successfully added to your cart.',
                    confirmButtonText: 'Okay'
                });

                updateCart(data.cart);  
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: data.message,
                    confirmButtonText: 'Okay'
                });
            }
        })
        .catch(error => console.error('Error:', error));
    });
});



</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<%- include("../partials/user/footer") %>



